var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function i(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,i)}l((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),a=require("@libs/defaultCover"),o=require("@libs/novelStatus"),s=function(){function s(){var t=this;this.id="bellerepository",this.name="Belle Repository",this.icon="src/en/bellerepository/mainducky.png",this.site="https://bellerepository.com/",this.version="1.0.1",this.filters=[],this.fallbackNovels=[{name:"The Unlikely Imprint of the Villainess and the Male Lead",cover:a.defaultCover,path:"/novel/the-unlikely-imprint-of-the-villainess-and-the-male-lead/"},{name:"Sample Novel 2",cover:a.defaultCover,path:"/novel/sample-novel-2/"},{name:"Sample Novel 3",cover:a.defaultCover,path:"/novel/sample-novel-3/"}],this.resolveUrl=function(e,r){return e.startsWith("http")?e:t.site+e.replace(/^\//,"")}}return s.prototype.popularNovels=function(o,s){return t(this,void 0,void 0,(function(){var t,s,i,l,c,u,h,p,f,v=this;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t="".concat(this.site,"page/").concat(o,"/"),[4,(0,n.fetchApi)(t)];case 1:if(!(s=e.sent()).ok)throw new Error("HTTP ".concat(s.status,": ").concat(s.statusText));return[4,s.text()];case 2:if(!(i=e.sent())||i.trim().length<100)throw new Error("Empty or insufficient response body");for(l=(0,r.load)(i),c=[],u=0,h=[".c-blog__content",".post-title a",".item-thumb a",'a[href*="/novel/"]',".manga-slider .slider__item a",".popular-slider .slider__item a"];u<h.length;u++){p=h[u];try{l(p).each((function(t,e){var r=l(e),n=r.text().trim()||r.attr("title")||"",o=r.attr("href");if(n&&o&&!(n.length<3)&&o.includes("novel")){var s=a.defaultCover,i=r.find("img").first();i.length&&(s=i.attr("data-src")||i.attr("src")||i.attr("data-lazy-src")||i.attr("data-original")||a.defaultCover),c.push({name:v.cleanText(n),cover:v.fixImageUrl(s),path:o.replace(v.site,"/")})}}))}catch(t){console.log("Selector ".concat(p," failed:"),t);continue}}return c.length>0?[2,this.deduplicateNovels(c).slice(0,20)]:(console.log("BelleRepository: Using fallback data - no novels found with any selector"),[2,this.fallbackNovels]);case 3:return f=e.sent(),console.error("BelleRepository: Error in popularNovels:",f),[2,this.fallbackNovels];case 4:return[2]}}))}))},s.prototype.parseNovel=function(s){return t(this,void 0,void 0,(function(){var t,i,l,c,u,h,p,f,v,m,d,g,y,b=this;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t=this.site+s.replace(/^\//,""),[4,(0,n.fetchApi)(t)];case 1:if(!(i=e.sent()).ok)throw new Error("HTTP ".concat(i.status,": Failed to fetch novel page"));return[4,i.text()];case 2:for(l=e.sent(),c=(0,r.load)(l),(u={path:s,name:this.cleanText(c("h1.post-title, h1, .entry-title, .manga-title").first().text()||"Unknown Novel")}).author=this.cleanText(c('.summary-content:contains("Author"), .post-content_item:contains("Author") .summary-content, .author, .manga-author').first().text()||"Unknown Author"),h=this.cleanText(c('.summary-content:contains("Status"), .post-content_item:contains("Status") .summary-content, .manga-status').first().text().toLowerCase()),u.status=h.includes("ongoing")||h.includes("active")?o.NovelStatus.Ongoing:o.NovelStatus.Completed,p=c(".summary_image img, .wp-post-image, .manga-cover img").first(),u.cover=p.attr("data-src")||p.attr("src")||a.defaultCover,u.genres=c(".summary-content a, .manga-genres a").map((function(t,e){return b.cleanText(c(e).text())})).get().filter((function(t){return t.length>0})).join(", "),u.summary=this.cleanText(c(".summary__content, .post-content, .manga-summary").first().text()||"No summary available."),f=[],v=!1,m=0,d=[".wp-manga-chapter",".listing-chapters li",".chapter-item",".manga-chapter-item","ul.chapters li",".c-chapter-list .chapter-item"];m<d.length;m++){g=d[m];try{if(c(g).each((function(t,e){var r=c(e),n=b.cleanText(r.find("a").first().text()),a=r.find("a").first().attr("href"),o=b.cleanText(r.find(".chapter-release-date, .post-on").first().text());n&&a&&(f.push({name:n,path:a.replace(b.site,"/"),releaseTime:o||null,chapterNumber:t+1}),v=!0)})),v)break}catch(t){console.log("Chapter selector ".concat(g," failed:"),t);continue}}return 0===f.length&&f.push({name:"Chapter 1",path:s+"chapter-1/",releaseTime:null,chapterNumber:1}),u.chapters=f.reverse(),[2,u];case 3:return y=e.sent(),console.error("BelleRepository: Error in parseNovel:",y),[2,{path:s,name:"Unknown Novel",author:"Unknown Author",cover:a.defaultCover,summary:"Unable to fetch novel details.",status:o.NovelStatus.Ongoing,chapters:[{name:"Chapter 1",path:s+"chapter-1/",releaseTime:null,chapterNumber:1}]}];case 4:return[2]}}))}))},s.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,o,s,i,l,c,u,h,p,f;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t=this.site+a.replace(/^\//,""),[4,(0,n.fetchApi)(t)];case 1:if(!(o=e.sent()).ok)throw new Error("HTTP ".concat(o.status,": Failed to fetch chapter"));return[4,o.text()];case 2:for(s=e.sent(),i=(0,r.load)(s),l=0,c=[".entry-content",".text-left",".text-right",".c-blog-post > div > div:nth-child(2)",".reading-content",".chapter-content",".post-content",".manga-reading-area"];l<c.length;l++){u=c[l];try{if((h=i(u).first()).length>0&&(h.find("script, style, .ads, .advertisement, .nav-next, .nav-prev, .chapter-nav, .pagination").remove(),(p=h.html())&&p.trim().length>50))return[2,p]}catch(t){continue}}return[2,"<p>Chapter content not available. Please read on the original website.</p>"];case 3:return f=e.sent(),console.error("BelleRepository: Error in parseChapter:",f),[2,"<p>Chapter content not available. Please read on the original website.</p>"];case 4:return[2]}}))}))},s.prototype.searchNovels=function(o,s){return t(this,void 0,void 0,(function(){var t,i,l,c,u,h,p,f=this;return e(this,(function(v){switch(v.label){case 0:v.trys.push([0,5,,6]),t=["".concat(this.site,"?s=").concat(encodeURIComponent(o),"&post_type=wp-manga"),"".concat(this.site,"?s=").concat(encodeURIComponent(o)),"".concat(this.site,"search/").concat(encodeURIComponent(o),"/")],i=function(t){var s,i,l,c;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,(0,n.fetchApi)(t)];case 1:return(s=e.sent()).ok?[4,s.text()]:[2,"continue"];case 2:return!(i=e.sent())||i.trim().length<100?[2,"continue"]:(l=(0,r.load)(i),c=[],l(".c-blog__content, .search-wrap .tab-content-wrap .c-tabs-item, .search-results .post-item").each((function(t,e){var r=l(e),n=r.find("h3 a, .post-title a, .manga-title a").first().text().trim(),s=r.find("a").first().attr("href");n&&s&&n.toLowerCase().includes(o.toLowerCase())&&c.push({name:n,cover:a.defaultCover,path:s.replace(f.site,"/")})})),c.length>0?[2,{value:c.slice(0,20)}]:[3,4]);case 3:return e.sent(),[2,"continue"];case 4:return[2]}}))},l=0,c=t,v.label=1;case 1:return l<c.length?(u=c[l],[5,i(u)]):[3,4];case 2:if("object"==typeof(h=v.sent()))return[2,h.value];v.label=3;case 3:return l++,[3,1];case 4:return[2,this.popularNovels(s,{showLatestNovels:!1})];case 5:return p=v.sent(),console.error("BelleRepository: Error in searchNovels:",p),[2,this.popularNovels(s,{showLatestNovels:!1})];case 6:return[2]}}))}))},s.prototype.cleanText=function(t){return t?t.trim().replace(/\s+/g," "):""},s.prototype.fixImageUrl=function(t){return t&&t!==a.defaultCover?t.startsWith("http")?t:t.startsWith("//")?"https:"+t:this.site+t.replace(/^\//,""):a.defaultCover},s.prototype.deduplicateNovels=function(t){var e=new Set;return t.filter((function(t){var r=t.path;return!e.has(r)&&(e.add(r),!0)}))},s}();exports.default=new s;