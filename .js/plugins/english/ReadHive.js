var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function o(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}c((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),s=require("@libs/defaultCover"),a=function(){function a(){var e=this;this.id="readhive",this.name="ReadHive",this.icon="src/en/readhive/FO721D5FA0CC7-02-scaled-e1658075230203-150x150.jpg",this.site="https://readhive.org",this.version="2.0.1",this.filters=void 0,this.resolveUrl=function(t){return t.startsWith("http")?t:e.site+(t.startsWith("/")?t:"/"+t)}}return a.prototype.popularNovels=function(a,i){return e(this,void 0,void 0,(function(){var e,o,c,l,h,u=this;return t(this,(function(t){switch(t.label){case 0:return a>34?[2,[]]:(e=1===a?this.site:"".concat(this.site,"/page/").concat(a,"/"),[4,(0,r.fetchApi)(e)]);case 1:return[4,t.sent().text()];case 2:return o=t.sent(),c=(0,n.load)(o),l=[],h=new Set,i.showLatestNovels?c('h2:contains("Latest Updates")').next(".flex-wrap").find(".px-2.mb-4").each((function(e,t){var r=c(t).find("a.peer").attr("href");if(r&&!h.has(r)){var n=c(t).find("a.text-lg").text().trim(),a=c(t).find("img").attr("src");a&&!a.startsWith("http")&&(a=u.resolveUrl(a)),l.push({name:n,path:r,cover:a||s.defaultCover}),h.add(r)}})):1===a?c('h2:contains("Popular")').nextAll(".swiper").find(".swiper-slide").each((function(e,t){var r=c(t).find("a").attr("href");if(r&&!h.has(r)){var n=c(t).find("h6").text().trim(),a=c(t).find("img").attr("src");a&&!a.startsWith("http")&&(a=u.resolveUrl(a)),l.push({name:n,path:r,cover:a||s.defaultCover}),h.add(r)}})):c('a[href*="/series/"]').each((function(e,t){var r=c(t).attr("href");if(r&&r.includes("/series/")&&!h.has(r)){var n=c(t).text().trim();if(n.length<3)n=c(t).closest(".px-2.mb-4, .flex-wrap, article, div").find("a.text-lg, h6, .font-bold").first().text().trim()||n;var a=c(t).find("img").attr("src")||c(t).closest("div").find("img").first().attr("src");a&&!a.startsWith("http")&&(a=u.resolveUrl(a)),l.push({name:n,path:r,cover:a||s.defaultCover}),h.add(r)}})),[2,l]}}))}))},a.prototype.searchNovels=function(n,a){return e(this,void 0,void 0,(function(){var e,a,i,o,c,l,h,u,d,p,f,v=this;return t(this,(function(t){switch(t.label){case 0:t.trys.push([0,8,,9]),e="".concat(this.site,"/ajax"),a="6170aacf2b",t.label=1;case 1:return t.trys.push([1,4,,5]),[4,(0,r.fetchApi)("".concat(this.site,"/browse-series/"))];case 2:return[4,t.sent().text()];case 3:return i=t.sent(),(o=i.match(/x-data="browse\('([^']+)'\)"/))&&o[1]&&(a=o[1]),[3,5];case 4:return t.sent(),[3,5];case 5:return(c=new FormData).append("search",n),c.append("orderBy","recent"),c.append("post",a),c.append("action","fetch_browse"),[4,(0,r.fetchApi)(e,{method:"POST",body:c,headers:{Accept:"application/json, text/javascript, */*; q=0.01","X-Requested-With":"XMLHttpRequest","User-Agent":"Mozilla/5.0 (Linux; Android 10; SM-G973F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.120 Mobile Safari/537.36",Referer:"".concat(this.site,"/browse-series/")}})];case 6:return(l=t.sent()).ok?[4,l.text()]:(console.error("[ReadHive] AJAX request failed:",l.status,l.statusText),[2,[]]);case 7:h=t.sent(),console.log("[ReadHive] Raw response:",h.substring(0,200)),u=void 0;try{u=JSON.parse(h),console.log("[ReadHive] Parsed JSON:",u)}catch(e){return console.error("[ReadHive] JSON parse error:",e),[2,[]]}if(d=[],p=[],u&&u.success&&u.data&&u.data.posts&&Array.isArray(u.data.posts))p=u.data.posts,console.log("[ReadHive] Found posts array in data.posts, length:",p.length);else if(u&&u.posts&&Array.isArray(u.posts))p=u.posts,console.log("[ReadHive] Found posts array in posts, length:",p.length);else{if(!Array.isArray(u))return console.log("[ReadHive] No posts array found in response, returning empty"),[2,d];p=u,console.log("[ReadHive] Response is direct array, length:",p.length)}return p.forEach((function(e){var t,r,n,a,i,o,c,l,h=null!==(a=null!==(r=null===(t=e.permalink)||void 0===t?void 0:t.replace(v.site,""))&&void 0!==r?r:null===(n=e.url)||void 0===n?void 0:n.replace(v.site,""))&&void 0!==a?a:"",u=null!==(c=null!==(o=null===(i=e.title)||void 0===i?void 0:i.rendered)&&void 0!==o?o:e.title)&&void 0!==c?c:"",p=null!==(l=e.thumbnail)&&void 0!==l?l:"";h&&h.includes("/series/")?(console.log("[ReadHive] Adding novel:",{name:u,path:h,cover:p}),d.push({name:u,path:h,cover:p?v.resolveUrl(p):s.defaultCover})):console.log("[ReadHive] Skipping non-series item:",{name:u,path:h})})),console.log("[ReadHive] Returning",d.length,"novels"),[2,d];case 8:return f=t.sent(),console.error("[ReadHive] Search error:",f),[2,[]];case 9:return[2]}}))}))},a.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,i,o,c,l,h,u,d,p,f,v,m,g,x,y,b=this;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(a),[4,(0,r.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),o=(0,n.load)(i),c=o("h1").first().text().trim()||"",l=o('img[alt*="Cover"]').attr("src")||o('img[class*="object-cover"]').attr("src")||s.defaultCover,h="",u=o("h1").next(),h=u.length?u.text().trim():o('span[class*="leading-7"]').text().trim()||o(".text-sm.text-muted").first().text().trim()||"",d="",(p=o('h2:contains("Synopsis"), h3:contains("Synopsis"), h4:contains("Synopsis")')).length&&(d=p.next("div").find("p").text().trim()||p.nextUntil("h2, h3, h4").text().trim()),f=o('a[href*="/genre/"]').map((function(e,t){return o(t).text().trim()})).get().filter((function(e){return e.length>0})).join(", "),v={path:a,name:c,cover:this.resolveUrl(l),author:h,summary:d,genres:f,chapters:[]},m=[],g=a.match(/\/series\/(\d+)/),x=g?g[1]:null,o('a[href*="/series/"]').filter((function(e,t){var r=o(t).attr("href");return!!r&&(!(x&&!r.includes("/series/".concat(x,"/")))&&(r!==a&&!r.includes("#")&&(r.match(/\/series\/\d+\/\d+\/?$/)||r.match(/\/series\/\d+\/v\d+\/[\d.]+\/?$/))))})).each((function(e,t){var r=o(t),n=r.attr("href");if(n&&(!x||n.includes("/series/".concat(x,"/")))){var s=r.text().trim()||r.attr("title")||"Chapter ".concat(e+1);if(!1!==s.toLowerCase().includes("chapter")||!1!==s.toLowerCase().includes("vol.")||!1!==s.toLowerCase().includes("prologue")||!1!==s.toLowerCase().includes("epilogue")||n.match(/\/v\d+\/[\d.]+/)||n.match(/\/\d+\/$/)){var a="",i=r.find('time, .time, .date, span[class*="time"], span[class*="date"]');i.length&&(a=i.text().trim()),m.push({name:s,path:n.replace(b.site,""),releaseTime:a})}}})),m.sort((function(e,t){var r=e.path.match(/\/(\d+)(?:\/|$)/),n=t.path.match(/\/(\d+)(?:\/|$)/);return r&&n?parseInt(r[1])-parseInt(n[1]):e.path.localeCompare(t.path)})),y=m.filter((function(e,t,r){return t===r.findIndex((function(t){return t.path===e.path}))})).slice(0,200),v.chapters=y,[2,v]}}))}))},a.prototype.parseChapter=function(s){return e(this,void 0,void 0,(function(){var e,a,i,o;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(s),[4,(0,r.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return a=t.sent(),i=(0,n.load)(a),0===(o=i('div[class*="lg:grid-in-content"] div[style*="font-size"]')).length&&(o=i("article .entry-content, .post-content, .chapter-content, .content-body")),0===o.length&&(o=i("main .prose, .reader-content, .chapter-reader")),0===o.length&&(o=i('div[class*="content"], div[class*="chapter"], div[class*="reader"]')),o.find("div[data-fuse], .ads, .advertisement, .socials, .reader-settings, .nav-wrapper, .navigation, .pagination").remove(),o.find('p:contains("• • •"), p:contains("***")').remove(),o.find("p").each((function(e,t){var r,n=i(t).text().trim(),s=null===(r=i(t).html())||void 0===r?void 0:r.trim();n&&"&nbsp;"!==s&&""!==s&&"• • •"!==n||i(t).remove()})),o.find("p").each((function(e,t){var r=i(t);r.find("br, div, p").length||r.html("<p>"+r.html()+"</p>")})),[2,o.html()||""]}}))}))},a}();exports.default=new a;